
<!DOCTYPE html>

<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<title>Visualizador de Cifras</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
    body, html {
      height: 100%;
    }
    #left-panel {
      height: 100vh;
      overflow-y: auto;
      border-right: 1px solid #ccc;
    }
    #right-panel {
      height: 100vh;
      overflow-y: auto;
      padding: 20px;
      position: relative;
    }
    .song-div {
      display: none;
    }
    .song-div.active {
      display: block;
    }
    #pdfViewer {
      width: 100%;
      height: 80vh;
      border: none;
    }
		
	.list-group-item:hover {
	  cursor: pointer !important;
	}

  </style>
</head>
<body>

<div class="container-fluid">
<div class="row">
<!-- Painel Esquerdo -->
<div class="col-md-3 p-3" id="left-panel">


<div style="display:none">
  <!-- Abas -->
  <ul class="nav nav-tabs" id="abasExemplo" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="arqLoc-tab" data-bs-toggle="tab" data-bs-target="#arqLoc" type="button" role="tab" aria-controls="arqLoc" aria-selected="true">Local</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="arqGdr-tab" data-bs-toggle="tab" data-bs-target="#arqGdr" type="button" role="tab" aria-controls="arqGdr" aria-selected="false">Google Drive</button>
    </li>
  </ul>

  <!-- Conteúdo das Abas -->

  <div class="tab-content p-3 border border-top-0" id="abasExemploConteudo">
    <div class="tab-pane fade show active" id="arqLoc" role="tabpanel" aria-labelledby="arqLoc-tab">
		<br>
		<input accept=".txt,.pdf,.doc*,.html,.rtf" class="form-control" directory="True" id="folderInput" multiple="True" type="file" webkitdirectory="True"/>
	
    </div>
    <div class="tab-pane fade" id="arqGdr" role="tabpanel" aria-labelledby="arqGdr-tab">
		<br>	
		<input class="form-control" id="cloud-link" placeholder="https://drive.google.com/..." type="url"/>
		<input class="form-control mb-3" id="api-key" placeholder="Cole sua chave de API aqui" type="text"/>
		<button class="btn btn-outline-secondary w-100 mb-3" onclick="loadDriveFiles()">Carregar Arquivos do Drive</button>
    </div>
  </div>
</div>

  <!-- Rolagem de telas -->
<h5 class="mt-4">Rollout</h5>
<div class="input-group mb-3">
<input class="form-control" id="rollout-time" min="1" title="Tempo em segundos" type="number" value="90"/>
<button class="btn btn-primary" onclick="startRollout()" title="Iniciar">▶</button>
<button class="btn btn-warning" onclick="pauseRollout()" title="Pausar">❚❚</button>
<button class="btn btn-success" onclick="continueRollout()" title="Continuar">►</button>
<button class="btn btn-danger" onclick="stopRollout()" title="Parar">■</button>
</div>

  <!-- Filtros -->
<h5>Filtros</h5>
<input class="form-control mb-3" id="search-filter" placeholder="Buscar música..." type="text"/>

  <!-- Lista de musicas -->
<h5>Músicas</h5>
<ul class="list-group" id="songList" style="font-size: 12px;">

</ul>




</div>



<!-- Painel Direito -->
<div class="col-md-9" id="right-panel">
  <!-- Nome do arquivo -->
<h3 id="divTitulo">Arquivo Enviado</h3>

<div class="song-div" id="file-content">


  <!-- Divisões por tipo de arquivo  -->

<div    id="txtViewer" style="white-space: pre-wrap; font-family: monospace"></div>
 
<pre    id="preViewer" style="white-space: pre-wrap;"></pre>
 
<embed  id="pdfViewer" type="application/pdf"/>
  
<iframe id="htmViewer" style="width: 100%;height: 800px;border: none;"></iframe>
</div>
</div>
</div>
</div>
<script>




    function viewFile(file) {
        const fileType = file.type;
        const fileURL = URL.createObjectURL(file);
        const viewer = document.getElementById('pdfViewer');
        const iframeViewer = document.getElementById('iframe-viewer');
		
        if (fileType === 'application/pdf') {
            viewer.src = fileURL;
            viewer.style.display = 'block';
            iframeViewer.style.display = 'none';
        } else if (fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
            iframeViewer.src = `https://view.officeapps.live.com/op/view.aspx?src=${fileURL}`;
            iframeViewer.style.display = 'block';
            viewer.style.display = 'none';
        } else {
            alert('Unsupported file type');
        }
    }
    </script>

<script>

document.getElementById('api-key').value = "AIzaSyA5GXElqP8I_xgfxeJbUfcrXoy0J09VIwY";
document.getElementById('cloud-link').value = "https://drive.google.com/drive/folders/1QVP-5DJLkgWEe1P1BtkRXc5kI02_UO_q?usp=sharing";




document.getElementById('folderInput').addEventListener('change', function(event) {
  const files = event.target.files;
  const songList = document.getElementById('songList');
  songList.innerHTML = '';

  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const li = document.createElement('li');
    li.textContent = file.webkitRelativePath;
    li.className = 'list-group-item';
    li.style.cursor = 'pointer';
    li.dataset.index = i;

    li.onclick = function () {
      const reader = new FileReader();
      reader.onload = function (e) {
        const preViewer = document.getElementById('preViewer');
        const pdfViewer = document.getElementById('pdfViewer');
        const htmViewer = document.getElementById('htmViewer');
        const txtViewer = document.getElementById('txtViewer');

          txtViewer.style.display = 'none';
			  txtViewer.innerHTML = e.target.result;
          preViewer.style.display = 'none';
			  preViewer.textContent = e.target.result;
          pdfViewer.style.display = 'none';
              pdfViewer.src = URL.createObjectURL(file);
          htmViewer.style.display = 'none';
              htmViewer.src = URL.createObjectURL(file);

		

document.getElementById('divTitulo').innerHTML = file.name;
        if (file.type === "application/pdf") {
          //pdfViewer.src = URL.createObjectURL(file);
		  
          pdfViewer.src = URL.createObjectURL(file);
          pdfViewer.style.display = 'block';

        } else {
			if (file.type === "text/html") {
//			  txtViewer.src = URL.createObjectURL(file);
			  htmViewer.innerHTML = e.target.result;
			  htmViewer.style.display = 'block';
//			  htmViewer.style.font = 'Courier new';
			} else {
			  txtViewer.innerHTML = e.target.result;
			  txtViewer.style.display = 'block';
			}
		}
		
		
        showSong('file-content');
      };
      reader.readAsText(file);
    };

    songList.appendChild(li);
  }
});


</script>
<script>
  let rolloutInterval;
  let isPaused = false;
  let scrolled = 0;
  let scrollHeight;
  let step;

  function showSong(id) {
    document.querySelectorAll('.song-div').forEach(div => div.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

/*  'document.getElementById('genre-filter').addEventListener('change', filterSongs); */
  document.getElementById('search-filter').addEventListener('input', filterSongs);

  function filterSongs() {
/*    'const genre = document.getElementById('genre-filter').value.toLowerCase(); */
    const search = document.getElementById('search-filter').value.toLowerCase();
    document.querySelectorAll('#songList li').forEach(item => {
/*      'const matchesGenre = !genre || item.dataset.genre === genre; */
      const matchesSearch = !search || item.textContent.toLowerCase().includes(search);
      item.style.display = matchesSearch ? '' : 'none';
    });
  }

  function startRollout() {
    const seconds = parseInt(document.getElementById('rollout-time').value) * 1000;
    const panel = document.getElementById('right-panel');
    panel.scrollTop = 0;
    scrollHeight = panel.scrollHeight - panel.clientHeight;
    step = scrollHeight / (seconds / 100);
    scrolled = 0;
    isPaused = false;
    rolloutInterval = setInterval(() => {
      if (scrolled >= scrollHeight || isPaused) {
        clearInterval(rolloutInterval);
      } else {
        panel.scrollTop += step;
        scrolled += step;
      }
    }, 100);
  }

  function pauseRollout() {
    isPaused = true;
  }

  function continueRollout() {
    if (!isPaused) return;
    isPaused = false;
    const panel = document.getElementById('right-panel');
    rolloutInterval = setInterval(() => {
      if (scrolled >= scrollHeight || isPaused) {
        clearInterval(rolloutInterval);
      } else {
        panel.scrollTop += step;
        scrolled += step;
      }
    }, 100);
  }

  function stopRollout() {
    clearInterval(rolloutInterval);
    isPaused = false;
  }



  function loadFromCloud() {
  
  
    const url = document.getElementById('cloud-link').value;
    if (!url) return alert("Cole um link válido.");

    const viewer = document.getElementById('pdfViewer');
    const text = document.getElementById('preViewer');
    text.style.display = 'none';
    viewer.style.display = 'block';

    // Convert Google Drive link if necessary
    const driveMatch = url.match(/drive\.google\.com\/file\/d\/([^\/]+)\/view/);
    if (driveMatch) {
      const fileId = driveMatch[1];
      viewer.src = `https://drive.google.com/uc?export=view&id=${fileId}`;
    } else {
      viewer.src = url;
    }

    showSong('file-content');
  }
  
  function loadDriveFiles() {
  


    const apiKey = document.getElementById('api-key').value;
    const folderUrl = document.getElementById('cloud-link').value;
    const folderId = folderUrl.match(/[-\w]{25,}/);
    if (!apiKey || !folderId) return alert("Cole uma chave de API válida e um link de pasta do Google Drive.");

    fetch(`https://www.googleapis.com/drive/v3/files?q='${folderId[0]}' in parents&key=${apiKey}`)
      .then(response => response.json())
      .then(data => {
        const songList = document.getElementById('songList');
        songList.innerHTML = '';
        data.files.forEach(file => {
		  const listItem = document.createElement('li');
		  listItem.className = 'list-group-item';
		  listItem.style = "cursor: pointer;" 
		  listItem.textContent = file.name;
		  listItem.onclick = () => showDriveFile(file.id, file.mimeType, file.name);
		  songList.appendChild(listItem);
        });
      })
      .catch(error => console.error('Erro ao carregar arquivos do Drive:', error));
  }  

/*
function showDriveFile(fileId, mimeType) {
  const viewer = document.getElementById('pdfViewer');
  const text = document.getElementById('preViewer');

  if (mimeType === 'application/pdf') {
    viewer.src = `https://drive.google.com/file/d/${fileId}/preview`;
    text.style.display = 'none';
    viewer.style.display = 'block';
  } else {
    fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${document.getElementById('api-key').value}`)
      .then(response => response.text())
      .then(data => {
        text.textContent = data;
        text.style.display = 'block';
        viewer.style.display = 'none';
      })
      .catch(error => console.error('Erro ao carregar arquivo:', error));
  }

  showSong('file-content');
}
*/
function showDriveFile(fileId, mimeType, nome) {

document.getElementById('divTitulo').innerHTML = nome;



  const pdfViewer = document.getElementById('pdfViewer');
  const txtViewer = document.getElementById('txtViewer');
  pdfViewer.innerHTML = ''; // Limpa conteúdo anterior
  txtViewer.innerHTML = ''; // Limpa conteúdo anterior

  if (mimeType === 'application/pdf') {
    const iframe = document.createElement('iframe');
    iframe.src = `https://drive.google.com/file/d/${fileId}/preview`;
    iframe.width = '100%';
    iframe.height = '100%';
    iframe.style.border = 'none';
    iframe.style.minHeight = '800px';
    pdfViewer.appendChild(iframe);
    pdfViewer.style.display = 'block';
    txtViewer.style.display = 'none';
  } else {
    fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${document.getElementById('api-key').value}`)
      .then(response => response.text())
      .then(data => {
        txtViewer.textContent = data;
        txtViewer.style.display = 'block';
        pdfViewer.style.display = 'none';
      })
      .catch(error => console.error('Erro ao carregar arquivo:', error));
  }

  showSong('file-content');
}



  document.addEventListener('DOMContentLoaded', function() {
    loadDriveFiles();
  });

  
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
